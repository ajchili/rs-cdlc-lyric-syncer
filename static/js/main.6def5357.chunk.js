(this["webpackJsonprs-cdlc-lyric-syncer"]=this["webpackJsonprs-cdlc-lyric-syncer"]||[]).push([[0],{19:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n(1),c=n.n(a),r=n(9),s=n.n(r),l=n(2),o=n(3),u=n(5),d=n(4),j=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).audioInputValueChanged=function(){var e=i.props.setMedia;if(e){var t=i.audioInput.current.files[0],n=URL.createObjectURL(t);e(t.name,t.type,n)}},i.selectAudioSource=function(){i.audioInput.current.click()},i.audioInput=c.a.createRef(),i}return Object(o.a)(n,[{key:"render",value:function(){return Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{className:"uk-button uk-button-default uk-button-small",onClick:this.selectAudioSource,children:"Select Audio Source"}),Object(i.jsx)("input",{type:"file",accept:"audio/*",ref:this.audioInput,onChange:this.audioInputValueChanged,hidden:!0})]})}}]),n}(a.Component),h={SPACE:"Play/Pause",H:"Add lyric at current time",J:"End lyric at current time",K:"End verse at current time"},m=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).renderHotkeys=function(){var e=[];for(var t in h)e.push(Object(i.jsxs)("span",{children:[Object(i.jsx)("strong",{children:t})," - ",h[t]]}));return e.map((function(e,t){return Object(i.jsx)("li",{children:e},t)}))},e}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.id,t=void 0===e?"help-modal":e;return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("a",{className:"uk-button uk-button-text",href:"#".concat(t),"uk-toggle":"target: #".concat(t),children:"Help"}),Object(i.jsx)("div",{id:t,className:"uk-flex-top","uk-modal":"true",children:Object(i.jsxs)("div",{className:"uk-modal-dialog uk-modal-body uk-margin-auto-vertical",children:[Object(i.jsx)("button",{className:"uk-modal-close-default",type:"button","uk-close":"true"}),Object(i.jsx)("h1",{className:"uk-heading-line",children:Object(i.jsx)("span",{children:"Hotkeys"})}),Object(i.jsx)("ul",{className:"uk-list",children:this.renderHotkeys()})]})})]})}}]),n}(a.Component),p=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(i.jsxs)("div",{className:"uk-margin-top",children:[Object(i.jsx)(m,{}),Object(i.jsx)("a",{className:"uk-button uk-button-text uk-margin-left",href:"https://github.com/ajchili/rs-cdlc-lyric-syncer",target:"_blank",children:"Github"}),Object(i.jsx)("a",{className:"uk-button uk-button-text uk-margin-left",href:"https://github.com/ajchili/rs-cdlc-lyric-syncer/issues/new",target:"_blank",children:"Report an Issue"})]})}}]),n}(a.Component),b=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(i.jsx)("div",{className:"uk-margin-top",children:Object(i.jsx)("h1",{className:"uk-heading-line uk-text-center",children:Object(i.jsx)("span",{children:"Better UltraStar Creator"})})})}}]),n}(a.Component),f=n(10),v=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.full,n=void 0!==t&&t,a=e.type,c=void 0===a?"default":a,r=e.onClick,s=void 0===r?function(){}:r,l=e.text,o=e.title,u=void 0===o?null:o;return Object(i.jsx)("button",{className:"uk-button uk-button-".concat(c," uk-button-small ").concat(n&&"uk-width-1-1"),onClick:function(e){s&&s(e)},title:u,children:l})}}]),n}(a.Component),y=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).importFromTextfield=function(){var e=i.props.onImport,t=i.state.lyrics;if(null!=t&&0!==t.length){for(var n=t;n.includes("\n");)n=n.replace("\n"," ");n=n.split(" ");var a,c=[],r=Object(f.a)(n);try{for(r.s();!(a=r.n()).done;){a.value.split("-").forEach((function(e,t,n){n.length-1===t?c.push(e):c.push("".concat(e,"-"))}))}}catch(s){r.e(s)}finally{r.f()}e(c)}},i.importFromFile=function(){},i.state={lyrics:""},i}return Object(o.a)(n,[{key:"render",value:function(){var e=this,t=this.state.lyrics;return Object(i.jsx)("div",{className:"uk-card uk-card-default uk-card-body",children:Object(i.jsxs)("div",{className:"uk-flex uk-flex-column uk-height-1-1",children:[Object(i.jsx)("h3",{className:"uk-card-title",children:"Import Lyrics"}),Object(i.jsx)("textarea",{className:"uk-textarea uk-flex-1",placeholder:"Lyrics",style:{resize:"none"},value:t,onChange:function(t){t.stopPropagation(),e.setState({lyrics:t.target.value})}}),Object(i.jsx)("div",{className:"uk-margin-top",children:Object(i.jsx)(v,{full:!0,text:"Import From Textfield",onClick:this.importFromTextfield})})]})})}}]),n}(a.Component),x=n(12),O=n(11),k=n.n(O),g=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.clear,n=void 0===t?function(){}:t,a=e.lyrics;return Object(i.jsx)("div",{className:"uk-width-1-3 uk-grid-item-match",children:Object(i.jsxs)("div",{className:"uk-flex uk-flex-column uk-height-1-1",style:{height:"35vh"},children:[Object(i.jsx)("h5",{className:"uk-heading-bullet",children:Object(i.jsxs)("span",{children:["Next Lyric: ",Object(i.jsx)("strong",{children:a[0]})]})}),Object(i.jsx)("div",{className:"uk-flex-1",style:{maxHeight:"100%",overflowY:"scroll"},children:Object(i.jsx)("ul",{className:"uk-list uk-list-striped",children:a.slice(1).map((function(e,t){return Object(i.jsx)("li",{children:e},t)}))})}),Object(i.jsx)("div",{className:"uk-margin-top",children:Object(i.jsx)(v,{full:!0,text:"Clear",onClick:n})})]})})}}]),n}(a.Component),w=window.AudioContext||window.webkitAudioContext,N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).initializePeaks=function(){var e=i.props.media;i.setState({instance:null}),i.audio.current.setAttribute("src",e.url),i.audio.current.setAttribute("type",e.type),i.audio.current.load();var t=new w,n={containers:{overview:document.getElementById("overview-container"),zoomview:document.getElementById("zoomview-container")},emitCueEvents:!0,mediaElement:i.audio.current,webAudio:{audioContext:t,scale:64,multiChannel:!0},keyboard:!0,showPlayheadTime:!0,zoomLevels:[64,128,256,512,1024,2048,4096,8192]};k.a.init(n,(function(e,t){i.setState({instance:t}),e?console.error(e.message):(console.log("Peak instance initialized."),t.on("points.enter",(function(e){var t="#666"===e.color;i.setState({currentLyric:t?e.labelText:null})})),t.on("points.dblclick",i.editLyric),document.querySelector('input[data-action="change-volume"]').onchange=i.changeVolume)}))},i.addEventListeners=function(){document.onkeydown=i.handleKeyDown},i.download=function(e,t,n){var i="".concat(t," - ").concat(e," lyrics.txt"),a=new Blob([n],{type:"data:text/plain;"}),c=URL.createObjectURL(a),r=document.createElement("a");r.setAttribute("href",c),r.setAttribute("download",i),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},i.export=function(){var e=i.props.media,t=i.state.instance;if(null!==t){var n=prompt("Song title",e.title);if(null!==n&&0!==n.trim().length){var a=prompt("Artist","");if(null!==a&&0!==a.trim().length){var c=prompt("BPM","100");if(null!==c&&0!==c.trim().length){c=parseInt(c,10);var r=t.points.getPoints().sort((function(e,t){return e.time-t.time})),s=1e3*(r.length>0?r[0].time:0),l=c/15e3,o=["#TITLE:".concat(n),"#ARTIST:".concat(a),"#BPM:".concat(c),"#GAP:".concat(Math.floor(s))].concat(Object(x.a)(r.map((function(e,t){if("#0000FF"===e.color)return null;var n="#FF0000"===e.color,i=1e3*e.time,a=Math.floor((i-s)*l);if(n)return"- ".concat(t>0?Math.max(a+1,a):a);var c=1;if(t+1<r.length){var o=1e3*r[t+1].time,u=Math.floor((o-s)*l);c=Math.max(1,u-a)}var d=e.labelText;return"-"===d.slice(-1)&&(d=d.substr(0,d.length-1)),t>0&&"#FF0000"===r[t-1].color||t>0&&"-"!==r[t-1].labelText.slice(-1)?": ".concat(a," ").concat(c," 0  ").concat(d):": ".concat(a," ").concat(c," 0 ").concat(d)}))),["E"]).filter((function(e){return null!==e}));i.download(n,a,o.join("\n"))}}}}},i.handleKeyDown=function(e){switch(e.code.toLowerCase()){case"space":i.togglePaused();break;case"keyh":i.addLyric();break;case"keyj":i.addEndOfLyric();break;case"keyk":i.addEndOfVerse();break;default:console.log(e)}},i.clearLyrics=function(){i.setState({importedLyrics:[]},i.resizeView)},i.addLyric=function(){var e=i.state,t=e.importedLyrics,n=e.instance;if(null!==n){var a=i.audio.current.paused,c=n.player.getCurrentTime(),r="";if(t.length>0)r=t[0],i.setState({importedLyrics:t.slice(1)},i.resizeView);else if(n.player.pause(),null===(r=prompt("Please provide a lyric",""))||0===r.trim().length)return void(a||n.player.play());n.points.add({time:c,labelText:r,editable:!0,color:"#666"}),a||n.player.play()}},i.editLyric=function(e){var t=i.state.instance;if(null!==t)if("#666"!==e.color)window.confirm("Do you want to delete this end marker?")&&t.points.removeById(e.id);else{var n=prompt("Update lyric, leave blank to remove",e.labelText);null!==n&&0!==n.trim().length?e.update({labelText:n}):t.points.removeById(e.id)}},i.addEndOfLyric=function(){var e=i.state.instance;if(null!==e){var t=i.audio.current.paused;e.player.pause(),e.points.add({time:e.player.getCurrentTime(),labelText:"(end of lyric)",editable:!0,color:"#0000FF"}),t||e.player.play()}},i.addEndOfVerse=function(){var e=i.state.instance;if(null!==e){var t=i.audio.current.paused;e.player.pause(),e.points.add({time:e.player.getCurrentTime(),labelText:"(end of verse)",editable:!0,color:"#FF0000"}),t||e.player.play()}},i.changeVolume=function(){if(null!==i.state.instance){var e=parseFloat(document.querySelector('input[data-action="change-volume"]').value)||0;i.audio.current.volume=e}},i.togglePaused=function(){var e=i.state.instance;if(null!==e){var t=i.audio.current.paused;i.setState({currentLyric:null,playButtonText:t?"Pause":"Play"}),t?e.player.play():e.player.pause()}},i.zoomIn=function(){var e=i.state.instance;null!==e&&e.zoom.zoomIn()},i.zoomOut=function(){var e=i.state.instance;null!==e&&e.zoom.zoomOut()},i.resizeView=function(){var e=i.state.instance;null!==e&&[e.views.getView("zoomview"),e.views.getView("overview")].forEach((function(e){return e.fitToContainer()}))},i.state={importedLyrics:[],instance:null,currentLyric:null,playButtonText:"Play"},i.audio=c.a.createRef(),window.addEventListener("resize",i.resizeView),i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.initializePeaks(),this.addEventListeners()}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props,n=t.lyrics,i=t.resetLyrics;n.length>0&&i((function(){e.setState({importedLyrics:n},e.resizeView)}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.media,a=t.toggleImportView,c=this.state,r=c.importedLyrics,s=c.instance,l=c.currentLyric,o=c.playButtonText;return Object(i.jsxs)("div",{className:"uk-card uk-card-default uk-card-body",children:[Object(i.jsx)("h3",{className:"uk-card-title",children:n.title}),Object(i.jsx)("h4",{className:"uk-heading-bullet",children:Object(i.jsx)("span",{children:l})}),Object(i.jsxs)("div",{"uk-grid":"true",children:[Object(i.jsxs)("div",{id:"peaks-container",className:"uk-width-expand",children:[Object(i.jsx)("div",{id:"zoomview-container",style:{height:"20vh"}}),Object(i.jsx)("div",{id:"overview-container",style:{height:"15vh"}})]}),r.length>0&&Object(i.jsx)(g,{clear:this.clearLyrics,lyrics:r})]}),null===s?Object(i.jsxs)("dl",{className:"uk-description-list",children:[Object(i.jsx)("dt",{children:"Processing song data..."}),Object(i.jsxs)("dd",{children:['Please wait as "',n.title,'" is processed...']}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{"uk-spinner":"ratio: 1"})]}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"uk-form-stacked",children:[Object(i.jsxs)("div",{"uk-grid":"true",className:"uk-margin-top uk-child-width-expand",children:[Object(i.jsxs)("div",{children:[Object(i.jsx)("label",{className:"uk-form-label",children:"Controls"}),Object(i.jsxs)("div",{className:"uk-button-group",children:[Object(i.jsx)(v,{onClick:this.togglePaused,text:o,title:"(SPACE)"}),Object(i.jsx)(v,{onClick:this.zoomIn,text:"Zoom in"}),Object(i.jsx)(v,{onClick:this.zoomOut,text:"Zoom out"})]})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)("label",{className:"uk-form-label",children:"Volume"}),Object(i.jsx)("div",{className:"uk-form-controls",children:Object(i.jsx)("input",{className:"uk-range","data-action":"change-volume",type:"range",defaultValue:"1",min:"0",max:"1",step:"0.01"})})]})]}),Object(i.jsxs)("div",{className:"uk-margin-top",children:[Object(i.jsx)("label",{className:"uk-form-label",children:"Lyric Options"}),Object(i.jsxs)("div",{className:"uk-button-group",children:[Object(i.jsx)(v,{onClick:function(){return a(e.resizeView)},text:"Import",type:"secondary"}),Object(i.jsx)(v,{onClick:this.export,text:"Export",type:"primary"}),Object(i.jsx)(v,{onClick:this.addLyric,text:"Add lyric at current time",title:"(H)"}),Object(i.jsx)(v,{onClick:this.addEndOfLyric,text:"End lyric at current time",title:"(J)"}),Object(i.jsx)(v,{onClick:this.addEndOfVerse,text:"End verse at current time",title:"(K)"})]})]})]})}),Object(i.jsx)("audio",{ref:this.audio,hidden:!0})]})}}]),n}(a.Component),C=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).setMedia=function(e,t,n){i.setState({media:null},(function(){i.setState({media:{title:e,type:t,url:n}})}))},i.setLyrics=function(e,t){i.setState({lyrics:e},t)},i.toggleImportView=function(e){var t=i.state.showImportView;i.setState({showImportView:!t},e)},i.state={lyrics:[],media:null,showImportView:!1},i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.setState({media:null})}},{key:"render",value:function(){var e=this,t=this.state,n=t.lyrics,a=t.media,c=t.showImportView;return Object(i.jsxs)("div",{className:"uk-container",children:[Object(i.jsx)(b,{}),Object(i.jsx)(j,{setMedia:this.setMedia}),Object(i.jsxs)("div",{"uk-grid":"true",className:"uk-margin-top",children:[Object(i.jsx)("div",{className:"uk-width-expand",children:null!==a&&Object(i.jsx)(N,{lyrics:n,media:a,toggleImportView:this.toggleImportView,resetLyrics:function(t){return e.setLyrics([],e.toggleImportView(t))}})}),c&&Object(i.jsx)("div",{className:"uk-width-1-3 uk-grid-item-match",children:Object(i.jsx)(y,{onImport:this.setLyrics})})]}),Object(i.jsx)(p,{})]})}}]),n}(a.Component);s.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(C,{})}),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.6def5357.chunk.js.map